<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>АвтоЗапчасти63</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="main.css">
    <style>
        /* Скрываем отладочные сообщения */
        .debug-logs {
            display: none !important;
        }
    </style>
</head>
<body>
    <div id="loading-screen" class="loading-screen">
        <div class="gear-container">
            <svg class="gear" viewBox="0 0 100 100">
                <path class="gear-path" d="M50 25c-13.8 0-25 11.2-25 25s11.2 25 25 25 25-11.2 25-25-11.2-25-25-25zm0 45c-11 0-20-9-20-20s9-20 20-20 20 9 20 20-9 20-20 20zm0-35c-8.3 0-15 6.7-15 15s6.7 15 15 15 15-6.7 15-15-6.7-15-15-15zm0 25c-5.5 0-10-4.5-10-10s4.5-10 10-10 10 4.5 10 10-4.5 10-10 10z"/>
                <path class="gear-teeth" d="M50 5v10m0 70v10M5 50h10m70 0h10M15 15l7 7m56 56l7 7M15 85l7-7m56-56l7-7"/>
            </svg>
        </div>
        <div class="loading-text">AUTO63</div>
    </div>

    <div id="app" class="app-container">
        <!-- Навигация -->
        <header class="header">
            <button class="btn-back">
                <svg class="icon" viewBox="0 0 24 24">
                    <path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"/>
                </svg>
            </button>
            <h1 class="app-title">АвтоЗапчасти63</h1>
            <div class="nav-actions">
                <button id="search-btn" class="nav-btn" data-screen="search">
                    <svg class="icon" viewBox="0 0 24 24">
                        <path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/>
                    </svg>
                </button>
                <button id="cart-btn" class="nav-btn" data-screen="cart">
                    <svg class="icon" viewBox="0 0 24 24">
                        <path d="M7 18c-1.1 0-1.99.9-1.99 2S5.9 22 7 22s2-.9 2-2-.9-2-2-2zM1 2v2h2l3.6 7.59-1.35 2.45c-.16.28-.25.61-.25.96 0 1.1.9 2 2 2h12v-2H7.42c-.14 0-.25-.11-.25-.25l.03-.12.9-1.63h7.45c.75 0 1.41-.41 1.75-1.03l3.58-6.49c.08-.14.12-.31.12-.48 0-.55-.45-1-1-1H5.21l-.94-2H1zm16 16c-1.1 0-1.99.9-1.99 2s.89 2 1.99 2 2-.9 2-2-.9-2-2-2z"/>
                    </svg>
                    <span id="cart-badge" class="badge">0</span>
                </button>
                <button id="profile-btn" class="nav-btn" data-screen="profile">
                    <svg class="icon" viewBox="0 0 24 24">
                        <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 3c1.66 0 3 1.34 3 3s-1.34 3-3 3-3-1.34-3-3 1.34-3 3-3zm0 14.2c-2.5 0-4.71-1.28-6-3.22.03-1.99 4-3.08 6-3.08 1.99 0 5.97 1.09 6 3.08-1.29 1.94-3.5 3.22-6 3.22z"/>
                    </svg>
                </button>
            </div>
        </header>

        <!-- Основной контент -->
        <main class="main-content">
            <!-- Домашний экран -->
            <div id="home-screen" class="screen">
                <section class="hero-section">
                    <h2>Автозапчасти с доставкой</h2>
                    <p>Оригинальные запчасти для вашего автомобиля</p>
                    <div class="stats">
                        <div class="stat-item">
                            <span class="stat-value">5+</span>
                            <span class="stat-label">Лет опыта</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-value">1000+</span>
                            <span class="stat-label">Запчастей</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-value">24/7</span>
                            <span class="stat-label">Поддержка</span>
                        </div>
                    </div>
                </section>

                <section class="categories-section">
                    <h2>Категории</h2>
                    <div class="categories"></div>
                </section>

                <section class="products-section">
                    <h2>Популярные товары</h2>
                    <div class="products"></div>
                </section>
            </div>

            <!-- Экран корзины -->
            <div id="cart-screen" class="screen">
                <div class="cart-container">
                    <h2>Корзина</h2>
                    <div class="cart-items"></div>
                </div>
            </div>

            <!-- Экран профиля -->
            <div id="profile-screen" class="screen">
                <div class="profile-container">
                    <div class="profile-info"></div>
                </div>
            </div>

            <!-- Экран оформления заказа -->
            <div id="checkout-screen" class="screen">
                <div class="checkout-container"></div>
            </div>
        </main>
    </div>

    <script>
        // Глобальная функция логирования
        window.logInitialization = function(message, data = null) {
            console.log(`[${new Date().toISOString()}] ${message}`, data || '');
        };

        // Функция для последовательной загрузки скриптов
        async function loadScript(src) {
            return new Promise((resolve, reject) => {
                const script = document.createElement('script');
                script.src = src;
                script.onload = resolve;
                script.onerror = reject;
                document.body.appendChild(script);
            });
        }

        // Инициализация приложения
        document.addEventListener('DOMContentLoaded', async () => {
            try {
                window.logInitialization('Начало инициализации приложения');

                // Инициализируем WebApp
                window.Telegram.WebApp.ready();
                window.logInitialization('Telegram WebApp инициализирован');
                
                // Загружаем скрипты последовательно
                await loadScript('data.js');
                await loadScript('Cart.js');
                await loadScript('Profile.js');
                await loadScript('Checkout.js');
                await loadScript('app.js');

                window.logInitialization('Все скрипты загружены');

            } catch (error) {
                console.error('Ошибка при инициализации:', error);
                document.body.innerHTML = `
                    <div class="error-screen">
                        <h1>Ошибка</h1>
                        <p>Произошла ошибка при загрузке приложения.</p>
                        <p>Пожалуйста, попробуйте позже.</p>
                    </div>
                `;
            }
        });
    </script>
</body>
</html>