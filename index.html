<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <base href="./" />
  <title>–ê–≤—Ç–æ–ó–∞–ø—á–∞—Å—Ç–∏63</title>
  <link rel="stylesheet" href="main.css?v=2025-08-12-5" />
</head>
<body>
  <!-- –ù–û–í–´–ô Loader Screen -->
  <div id="loading-screen">
    <div class="loading-content">
      <!-- –°–û–í–†–ï–ú–ï–ù–ù–ê–Ø –ó–ê–ì–†–£–ó–û–ß–ù–ê–Ø –®–ï–°–¢–ï–†–Å–ù–ö–ê -->
      <div class="gear-container">
        <svg class="gear-svg" viewBox="0 0 60 60" width="60" height="60">
          <g class="rotating-gear">
            <defs>
              <linearGradient id="modernGear" x1="0%" y1="0%" x2="100%" y2="100%">
                <stop offset="0%" style="stop-color:#60A5FA;stop-opacity:1" />
                <stop offset="50%" style="stop-color:#3B82F6;stop-opacity:1" />
                <stop offset="100%" style="stop-color:#1D4ED8;stop-opacity:1" />
              </linearGradient>
              <filter id="glow">
                <feGaussianBlur stdDeviation="2" result="coloredBlur"/>
                <feMerge>
                  <feMergeNode in="coloredBlur"/>
                  <feMergeNode in="SourceGraphic"/>
                </feMerge>
              </filter>
            </defs>
            
            <!-- –û—Å–Ω–æ–≤–Ω–∞—è —à–µ—Å—Ç–µ—Ä–Ω—è - 12 –∑—É–±—å–µ–≤ -->
            <g fill="url(#modernGear)" stroke="#1E40AF" stroke-width="1" filter="url(#glow)">
              <!-- –ó—É–±—å—è —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω—ã —Ä–∞–≤–Ω–æ–º–µ—Ä–Ω–æ -->
              <polygon points="30,3 33,6 33,12 30,15 27,12 27,6"/>
              <polygon points="30,3 33,6 33,12 30,15 27,12 27,6" transform="rotate(30 30 30)"/>
              <polygon points="30,3 33,6 33,12 30,15 27,12 27,6" transform="rotate(60 30 30)"/>
              <polygon points="30,3 33,6 33,12 30,15 27,12 27,6" transform="rotate(90 30 30)"/>
              <polygon points="30,3 33,6 33,12 30,15 27,12 27,6" transform="rotate(120 30 30)"/>
              <polygon points="30,3 33,6 33,12 30,15 27,12 27,6" transform="rotate(150 30 30)"/>
              <polygon points="30,3 33,6 33,12 30,15 27,12 27,6" transform="rotate(180 30 30)"/>
              <polygon points="30,3 33,6 33,12 30,15 27,12 27,6" transform="rotate(210 30 30)"/>
              <polygon points="30,3 33,6 33,12 30,15 27,12 27,6" transform="rotate(240 30 30)"/>
              <polygon points="30,3 33,6 33,12 30,15 27,12 27,6" transform="rotate(270 30 30)"/>
              <polygon points="30,3 33,6 33,12 30,15 27,12 27,6" transform="rotate(300 30 30)"/>
              <polygon points="30,3 33,6 33,12 30,15 27,12 27,6" transform="rotate(330 30 30)"/>
            </g>
            
            <!-- –¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π –¥–∏—Å–∫ -->
            <circle cx="30" cy="30" r="12" fill="url(#modernGear)" stroke="#1E40AF" stroke-width="2"/>
            
            <!-- –í–Ω—É—Ç—Ä–µ–Ω–Ω–µ–µ –∫–æ–ª—å—Ü–æ -->
            <circle cx="30" cy="30" r="8" fill="none" stroke="#1E40AF" stroke-width="1.5"/>
            
            <!-- –¶–µ–Ω—Ç—Ä–∞–ª—å–Ω–∞—è —Ç–æ—á–∫–∞ -->
            <circle cx="30" cy="30" r="3" fill="#1E40AF" stroke="#0F3460" stroke-width="1"/>
            
            <!-- –î–µ–∫–æ—Ä–∞—Ç–∏–≤–Ω—ã–µ –ª–∏–Ω–∏–∏ -->
            <g stroke="#1E40AF" stroke-width="1" fill="none">
              <line x1="30" y1="25" x2="30" y2="35"/>
              <line x1="25" y1="30" x2="35" y2="30"/>
            </g>
          </g>
        </svg>
      </div>
      
      <!-- –ü—Ä–æ–≥—Ä–µ—Å—Å –±–∞—Ä -->
      <div class="progress-container">
        <div class="progress-bar-new">
          <div class="progress-fill-new" id="progress-fill"></div>
        </div>
        <div class="loading-text">–ê–≤—Ç–æ–ó–∞–ø—á–∞—Å—Ç–∏163</div>
      </div>
    </div>
  </div>

  <!-- App Container -->
  <div id="app" style="display:none;">
    <!-- Navigation -->
    <nav class="nav-bar">
      <button class="btn-back" id="nav-back-btn">‚Üê</button>
      <h1 class="app-title">–ê–≤—Ç–æ–ó–∞–ø—á–∞—Å—Ç–∏63</h1>
      <div class="nav-actions">
        <button data-screen="home">üè†</button>
        <button data-screen="cart">üõí <span id="cart-badge">0</span></button>
        <button data-screen="profile">üë§</button>
      </div>
    </nav>

    <!-- Screens -->
    <main>
      <section id="home-screen" class="screen active"></section>
      <section id="product-screen" class="screen"></section>
      <section id="cart-screen" class="screen"></section>
      <section id="checkout-screen" class="screen"></section>
      <section id="profile-screen" class="screen"></section>
    </main>
  </div>

  <script>
    function loadScript(url){
      return new Promise((resolve,reject)=>{
        const s=document.createElement('script');
        s.src=url;
        s.defer=true;
        s.crossOrigin='anonymous';
        s.onload=resolve;
        s.onerror=()=>reject(new Error('script load failed: '+url));
        document.body.appendChild(s);
      });
    }

    async function loadWithFallbacks(relPathWithQuery){
      const candidates=[];
      try{
        candidates.push(new URL(relPathWithQuery, document.baseURI).href);
      }catch(_){}
      try{
        // –†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π GitHub Pages: /<repo>/... ‚Üí –¥–æ–∫–ª–µ–∏–≤–∞–µ–º doctordom
        const parts = location.pathname.split('/').filter(Boolean);
        const repo = parts.length ? `/${parts[0]}/` : '/';
        candidates.push(location.origin + repo + 'doctordom/' + relPathWithQuery);
      }catch(_){}
      // –ü–æ—Å–ª–µ–¥–Ω–∏–π –≤–∞—Ä–∏–∞–Ω—Ç ‚Äî –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω—ã–π
      candidates.push(relPathWithQuery);

      let lastErr;
      for(const url of candidates){
        try{ console.debug('Loading', url); await loadScript(url); return; }
        catch(e){ lastErr=e; }
      }
      throw lastErr || new Error('cannot load '+relPathWithQuery);
    }
    document.addEventListener('DOMContentLoaded', async () => {
      // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∞–Ω–∏–º–∞—Ü–∏—é –∑–∞–≥—Ä—É–∑–∫–∏
      const progressBar = document.getElementById('progress-fill');
      const loadingScreen = document.getElementById('loading-screen');
      const appContainer = document.getElementById('app');
      
      // –ò–º–∏—Ç–∏—Ä—É–µ–º –∑–∞–≥—Ä—É–∑–∫—É —Å –∫—Ä–∞—Å–∏–≤–æ–π –∞–Ω–∏–º–∞—Ü–∏–µ–π
      let progress = 0;
      const loadingInterval = setInterval(() => {
        progress += Math.random() * 15 + 5; // –°–ª—É—á–∞–π–Ω–æ–µ —É–≤–µ–ª–∏—á–µ–Ω–∏–µ –æ—Ç 5 –¥–æ 20%
        if (progress > 100) progress = 100;
        
        progressBar.style.width = progress + '%';
        
        if (progress >= 100) {
          clearInterval(loadingInterval);
          // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å–∫—Ä–∏–ø—Ç—ã –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ –∏ —Ç–æ–ª—å–∫–æ –∑–∞—Ç–µ–º –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
          (async () => {
            try {
              await loadScript('https://cdnjs.cloudflare.com/ajax/libs/lottie-web/5.12.2/lottie.min.js');
              const VERSION='2025-08-12-8';
              const rel = [
                'services/Router.js',
                'services/ThemeService.js',
                'services/UIService.js',
                'services/OrderService.js',
                'screens/Home.js',
                'screens/Search.js',
                'screens/Catalog.js',
                'screens/Product.js',
                'screens/Favorites.js',
                'screens/ProfileScreen.js',
                'screens/CartScreen.js',
                'screens/CheckoutScreen.js',
                'data.js','Cart.js','Profile.js','Checkout.js','app.js'
              ];
              for(const path of rel){
                await loadWithFallbacks(`${path}?v=${VERSION}`);
              }
            } catch (e) {
              console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –º–æ–¥—É–ª–µ–π', e);
              return;
            }
            // –ü–ª–∞–≤–Ω—ã–π –ø–µ—Ä–µ—Ö–æ–¥ –∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—é
            loadingScreen.style.opacity='0';
            setTimeout(()=>{
              loadingScreen.style.display='none';
              appContainer.style.display='block';
              appContainer.style.opacity='1';
              try { window.app && typeof window.app.init==='function' && window.app.init(); }
              catch(e){ console.error('–û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏', e); }
            },300);
          })();
        }
      }, 100); // –û–±–Ω–æ–≤–ª—è–µ–º –∫–∞–∂–¥—ã–µ 100ms
    });
  </script>
</body>
</html>